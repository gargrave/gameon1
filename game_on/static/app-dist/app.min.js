/* 
GameOn 
built on 2016/2/17 
*/
var App;!function(App){var Config;!function(Config){angular.module("gameon",["ui.router","ngMessages","common","menus","platforms","games"]).config(["$interpolateProvider","$httpProvider","$stateProvider","$urlRouterProvider",function($interpolateProvider,$httpProvider,$stateProvider,$urlRouterProvider){$stateProvider.state("home",{url:"/",templateUrl:"/static/views/home.html"}),$urlRouterProvider.otherwise("/"),$interpolateProvider.startSymbol("{A"),$interpolateProvider.endSymbol("A}"),$httpProvider.defaults.xsrfCookieName="csrftoken",$httpProvider.defaults.xsrfHeaderName="X-CSRFToken"}])}(Config=App.Config||(App.Config={}))}(App||(App={}));var App;!function(App){var Common;!function(Common){angular.module("common",[])}(Common=App.Common||(App.Common={}))}(App||(App={}));var App;!function(App){var Games;!function(Games){angular.module("games",["ui.router"]).config(["$stateProvider",function($stateProvider){$stateProvider.state("games-list",{url:"/games?filter",templateUrl:"/static/views/games/list.html",controller:"GamesCtrl as ctrl"}).state("games-create",{url:"/games/create",templateUrl:"/static/views/games/create.html",controller:"GamesCtrl as ctrl"}).state("games-detail",{url:"/games/:id",templateUrl:"/static/views/games/detail.html",controller:"GamesCtrl as ctrl"}).state("games-edit",{url:"/games/:id/edit",templateUrl:"/static/views/games/edit.html",controller:"GamesCtrl as ctrl"})}])}(Games=App.Games||(App.Games={}))}(App||(App={}));var App;!function(App){var Menus;!function(Menus){angular.module("menus",[])}(Menus=App.Menus||(App.Menus={}))}(App||(App={}));var App;!function(App){var Platforms;!function(Platforms){angular.module("platforms",["ui.router"]).config(["$stateProvider",function($stateProvider){$stateProvider.state("platforms-list",{url:"/platforms",templateUrl:"/static/views/platforms/list.html",controller:"PlatformsCtrl as ctrl"}).state("platforms-create",{url:"/platforms/create",templateUrl:"/static/views/platforms/create.html",controller:"PlatformsCtrl as ctrl"}).state("platforms-detail",{url:"/platforms/:id",templateUrl:"/static/views/platforms/detail.html",controller:"PlatformsCtrl as ctrl"}).state("platforms-edit",{url:"/platforms/:id/edit",templateUrl:"/static/views/platforms/edit.html",controller:"PlatformsCtrl as ctrl"})}])}(Platforms=App.Platforms||(App.Platforms={}))}(App||(App={}));var App;!function(App){var Common;!function(Common){function DaysFilter(){return function(input,endDate){var start=new Date(input),end=new Date(endDate),daysString="1 day";if(end>start){var diff=end.getTime()-start.getTime(),days=1+diff/MS_PER_DAY;daysString=days+" days"}return daysString}}function TruncFilter(){return function(input,len){var str=input;return str.length>len&&(str=input.substring(0,len)+"..."),str}}function PluralizeFilter(){return function(input,count){var str=input;return 1!==count&&(str+="s"),str}}function BooleanFilter(){return function(input){var str=input||"";return"true"===str.toString().toLowerCase()?"Yes":"No"}}var MS_PER_DAY=864e5;Common.DaysFilter=DaysFilter,angular.module("common").filter("daysFilter",DaysFilter),Common.TruncFilter=TruncFilter,angular.module("common").filter("truncFilter",TruncFilter),Common.PluralizeFilter=PluralizeFilter,angular.module("common").filter("pluralize",PluralizeFilter),Common.BooleanFilter=BooleanFilter,angular.module("common").filter("boolean",BooleanFilter)}(Common=App.Common||(App.Common={}))}(App||(App={}));var App;!function(App){var Common;!function(Common){var GenericController=function(){function GenericController($scope,$window,$stateParams,$state,dataSvc,moduleName){this.$scope=$scope,this.$window=$window,this.$stateParams=$stateParams,this.$state=$state,this.dataSvc=dataSvc,this.moduleName=moduleName,this.working=!1,this.error="",this.filterText="",this.sortText="name";var self=this;self.entries=[],self.newEntry=self.defaultEntry()}return GenericController.prototype.create=function(){var self=this;self.error="",self.buildSubmissionData(),self.preValidate()&&(self.working=!0,self.dataSvc.save(self.submissionData).then(function(res){self.entries.push(res),self.initCreateView(),self.gotoDetailView(res.id)},function(err){self.error=err.statusText})["finally"](function(){self.working=!1}))},GenericController.prototype.find=function(){var self=this;self.error="",self.working=!0,console.log(self.$stateParams),self.dataSvc.query().then(function(res){self.entries=res,self.onApiFindSuccess()},function(err){self.error=err.statusText})["finally"](function(){self.working=!1})},GenericController.prototype.findOne=function(){var self=this;self.error="",self.working=!0;var id=self.$stateParams.id;self.dataSvc.get(id).then(function(res){self.activeEntry=res,self.newEntry=angular.copy(self.activeEntry),self.onApiFindOneSuccess()},function(err){self.error="The entry with id# "+id+" could not be found.",self.gotoListView()})["finally"](function(){self.working=!1})},GenericController.prototype.update=function(){var self=this,id=self.activeEntry.id;self.error="",self.buildSubmissionData(),self.preValidate()&&self.canSaveEdits()&&(self.working=!0,self.dataSvc.update(self.submissionData).then(function(res){self.activeEntry=res,self.gotoDetailView(id)},function(err){self.error=err.statusText})["finally"](function(){self.working=!1}))},GenericController.prototype.remove=function(){var self=this;if(self.$window.confirm("Are you sure you want to delete this entry?")){self.error="",self.working=!0;var id=self.$stateParams.id;self.dataSvc.remove(id).then(function(res){_.remove(self.entries,function(e){return e.id===id}),self.gotoListView()},function(err){self.error=err.statusText})["finally"](function(){self.working=!1})}},GenericController.prototype.onApiFindSuccess=function(){},GenericController.prototype.onApiFindOneSuccess=function(){},GenericController.prototype.buildSubmissionData=function(){this.submissionData=angular.copy(this.newEntry)},GenericController.prototype.initCreateView=function(){var self=this;0===self.entries.length&&self.find(),self.newEntry=self.defaultEntry()},GenericController.prototype.initListView=function(){this.find()},GenericController.prototype.initEditView=function(){this.findOne()},GenericController.prototype.clearFilterText=function(){this.filterText=""},GenericController.prototype.setSortText=function(text){this.sortText===text?this.sortText="-"+text:this.sortText=text},GenericController.prototype.preValidate=function(){return!0},GenericController.prototype.canSaveEdits=function(){return this.error="Error: ctrl.canSaveEdits() not implemented.",!1},GenericController.prototype.gotoListView=function(){var self=this;self.$state.go(this.moduleName+"s-list")},GenericController.prototype.gotoDetailView=function(id){var self=this;self.$state.go(self.moduleName+"s-detail",{id:id})},GenericController}();Common.GenericController=GenericController}(Common=App.Common||(App.Common={}))}(App||(App={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},App;!function(App){var Games;!function(Games){var GamesCtrl=function(_super){function GamesCtrl($scope,$window,$stateParams,$state,dataSvc,platformsSvc){_super.call(this,$scope,$window,$stateParams,$state,dataSvc,"game"),this.platformsSvc=platformsSvc,this.sortText="-startDate"}return __extends(GamesCtrl,_super),GamesCtrl.prototype.defaultEntry=function(){return{name:"",platform:{id:-1,name:"",color:""},startDate:"",endDate:"",finished:!1}},GamesCtrl.prototype.buildSubmissionData=function(){this.submissionData={id:this.newEntry.id,name:this.newEntry.name,platform:this.newEntry.platform.id,startDate:this.newEntry.startDate,endDate:this.newEntry.endDate,finished:this.newEntry.finished}},GamesCtrl.prototype.onApiFindSuccess=function(){var self=this;self.entries.forEach(function(entry,idx,array){var start=new Date(entry.startDate),end=new Date(entry.endDate),diff=end.getTime()-start.getTime();entry.daysPlayed=1+diff/864e5}),self.filterText=self.$stateParams.filter||""},GamesCtrl.prototype.preValidate=function(){var self=this,form=self.$scope.entryForm;if(form.$submitted=!0,!form.$valid)return self.error="Invalid submission. Please check the form for errors.",!1;var platform=self.submissionData.platform;if("number"!=typeof platform||0>platform)return self.error="Local Error: Invalid platform identifier: "+platform,!1;var existing=_.find(self.entries,function(g){var game=g;return game.name===self.submissionData.name&&game.startDate===self.submissionData.startDate});return existing?(self.error="A game with an identical name and start-date already exists.",!1):!0},GamesCtrl.prototype.canSaveEdits=function(){var canSave=!0;return this.error="",this.newEntry.name===this.activeEntry.name&&this.newEntry.platform.id===this.activeEntry.platform.id&&this.newEntry.startDate===this.activeEntry.startDate&&this.newEntry.endDate===this.activeEntry.endDate&&this.newEntry.finished===this.activeEntry.finished&&(this.error="No changes have been made.",canSave=!1),canSave},GamesCtrl.prototype.shouldShowResultsAlert=function(){return!this.working&&""!==this.filterText},GamesCtrl}(App.Common.GenericController);Games.GamesCtrl=GamesCtrl,angular.module("games").controller("GamesCtrl",["$scope","$window","$stateParams","$state","gamesSvc","platformsSvc",GamesCtrl])}(Games=App.Games||(App.Games={}))}(App||(App={}));var App;!function(App){var Menus;!function(Menus){var MenusCtrl=function(){function MenusCtrl(menusSvc){this.menus=menusSvc.getMenus()}return MenusCtrl}();angular.module("menus").controller("MenusCtrl",["menusSvc",MenusCtrl])}(Menus=App.Menus||(App.Menus={}))}(App||(App={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},App;!function(App){var Platforms;!function(Platforms){var PlatformsCtrl=function(_super){function PlatformsCtrl($scope,$window,$stateParams,$state,dataSvc){_super.call(this,$scope,$window,$stateParams,$state,dataSvc,"platform")}return __extends(PlatformsCtrl,_super),PlatformsCtrl.prototype.defaultEntry=function(){return{name:"",color:""}},PlatformsCtrl.prototype.buildSubmissionData=function(){this.submissionData={id:this.newEntry.id,name:this.newEntry.name,color:this.newEntry.color}},PlatformsCtrl.prototype.preValidate=function(){var self=this,form=self.$scope.entryForm;if(form.$submitted=!0,!form.$valid)return self.error="Invalid submission. Please check the form for errors.",!1;var existing=_.find(self.entries,function(p){var plat=p;return plat.name===self.newEntry.name});return existing&&(self.error="A platform with an identical name already exists."),void 0===existing},PlatformsCtrl.prototype.canSaveEdits=function(){var canSave=!0;return this.error="",this.newEntry.name===this.activeEntry.name&&this.newEntry.color===this.activeEntry.color&&(this.error="No changes have been made.",canSave=!1),canSave},PlatformsCtrl}(App.Common.GenericController);Platforms.PlatformsCtrl=PlatformsCtrl,angular.module("platforms").controller("PlatformsCtrl",["$scope","$window","$stateParams","$state","platformsSvc",PlatformsCtrl])}(Platforms=App.Platforms||(App.Platforms={}))}(App||(App={}));var App;!function(App){var Common;!function(Common){var GenericService=function(){function GenericService($http,$q,moduleName){this.$http=$http,this.$q=$q,this.moduleName=moduleName,this.needsUpdate=!1}return GenericService.prototype.query=function(){var self=this,url="/api/"+self.moduleName+"s",deferred=self.$q.defer();return self.entries&&!self.needsUpdate?deferred.resolve(self.entries):self.$http.get(url).then(function(res){self.entries=res.data.entries,self.needsUpdate=!1,deferred.resolve(self.entries)},function(err){deferred.reject(err.data)}),deferred.promise},GenericService.prototype.get=function(id){var self=this,url="/api/"+self.moduleName+"s/"+id,deferred=self.$q.defer();return self.$http.get(url).then(function(res){deferred.resolve(res.data.entries[0])},function(err){deferred.reject(err.data)}),deferred.promise},GenericService.prototype.save=function(data){var self=this,url="/api/"+self.moduleName+"s/create",deferred=self.$q.defer();return self.$http.post(url,data).then(function(res){self.needsUpdate=!0,deferred.resolve(res.data.entries[0])},function(err){deferred.reject(err)}),deferred.promise},GenericService.prototype.update=function(data){var self=this,url="/api/"+self.moduleName+"s/update",deferred=self.$q.defer();return self.$http.post(url,data).then(function(res){self.needsUpdate=!0,deferred.resolve(res.data.entries[0])},function(err){deferred.reject(err)}),deferred.promise},GenericService.prototype.remove=function(id){var self=this,url="/api/"+self.moduleName+"s/delete",deferred=self.$q.defer();return self.$http.post(url,{id:id}).then(function(res){self.needsUpdate=!0,deferred.resolve(null)}),deferred.promise},GenericService}();Common.GenericService=GenericService}(Common=App.Common||(App.Common={}))}(App||(App={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},App;!function(App){var Games;!function(Games){var GamesSvc=function(_super){function GamesSvc($http,$q){_super.call(this,$http,$q,"game"),this.$http=$http,this.$q=$q}return __extends(GamesSvc,_super),GamesSvc}(App.Common.GenericService);Games.GamesSvc=GamesSvc,angular.module("games").service("gamesSvc",["$http","$q",GamesSvc])}(Games=App.Games||(App.Games={}))}(App||(App={}));var App;!function(App){var Menus;!function(Menus){var ParentMenu=function(){function ParentMenu(title,order){this.title=title,this.order=order,this.children=[]}return ParentMenu}();Menus.ParentMenu=ParentMenu;var ChildMenuData=function(){function ChildMenuData(title,link){this.title=title,this.link=link}return ChildMenuData}();Menus.ChildMenuData=ChildMenuData;var MenusSvc=function(){function MenusSvc(){this.menus=[]}return MenusSvc.prototype.getDropdownParent=function(title,order){void 0===order&&(order=100);var self=this,menu=_.find(self.menus,function(m){return m.title===title});return menu||(menu=new ParentMenu(title,order),self.menus.push(menu)),menu},MenusSvc.prototype.addDropdownChild=function(parent,child){var self=this,menu=self.getDropdownParent(parent),title=child.title,existing=_.find(menu.children,function(c){return c.title===title});void 0===existing&&menu.children.push(child)},MenusSvc.prototype.getMenus=function(){return this.menus},MenusSvc}();angular.module("menus").service("menusSvc",[MenusSvc])}(Menus=App.Menus||(App.Menus={}))}(App||(App={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},App;!function(App){var Platforms;!function(Platforms){var PlatformsSvc=function(_super){function PlatformsSvc($http,$q){_super.call(this,$http,$q,"platform"),this.$http=$http,this.$q=$q}return __extends(PlatformsSvc,_super),PlatformsSvc}(App.Common.GenericService);Platforms.PlatformsSvc=PlatformsSvc,angular.module("platforms").service("platformsSvc",["$http","$q",PlatformsSvc])}(Platforms=App.Platforms||(App.Platforms={}))}(App||(App={}));var App;!function(App){var Games;!function(Games){var ChildMenuData=App.Menus.ChildMenuData;angular.module("games").run(["menusSvc",function(menusSvc){var menu="Games";menusSvc.getDropdownParent(menu,0),menusSvc.addDropdownChild(menu,new ChildMenuData("List Games","games-list")),menusSvc.addDropdownChild(menu,new ChildMenuData("Add a Game","games-create"))}])}(Games=App.Games||(App.Games={}))}(App||(App={}));var App;!function(App){var Platforms;!function(Platforms){var ChildMenuData=App.Menus.ChildMenuData;angular.module("platforms").run(["menusSvc",function(menusSvc){var menu="Platforms";menusSvc.getDropdownParent(menu,1),menusSvc.addDropdownChild(menu,new ChildMenuData("List Platforms","platforms-list")),menusSvc.addDropdownChild(menu,new ChildMenuData("Add a Platform","platforms-create"))}])}(Platforms=App.Platforms||(App.Platforms={}))}(App||(App={}));var App;!function(App){var Platforms;!function(Platforms){var counter=0;angular.module("gameon").directive("datepicker",[function(){return{restrict:"AE",scope:{label:"@",name:"@",dateModel:"="},template:'\n        <label for="{A ::uniqueId A}"><span ng-bind="label"></span></label>\n        <div id="{A ::uniqueId A}">\n          <input type="text" class="form-control" name="{A ::name A}"\n                 maxlength="10" ng-pattern="/^20[0-1][0-9]-[0-1][0-9]-[0-3][0-9]$/"\n                 placeholder="Click to select date"\n                 ng-model="dateModel" required>\n        </div>\n        ',link:function($scope,elem){var dateInitialized=!1;$scope.uniqueId="datepicker_"+counter++,elem.find("input").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayHighlight:!0}),$scope.$watch("dateModel",function(){$scope.dateModel&&!dateInitialized&&(dateInitialized=!0,elem.find("input").datepicker("setUTCDate",new Date($scope.dateModel)))})}}}])}(Platforms=App.Platforms||(App.Platforms={}))}(App||(App={}));var App;!function(App){var Platforms;!function(Platforms){angular.module("platforms").directive("platformDropdown",["platformsSvc",function(platformsSvc){return{restrict:"AE",scope:{selected:"="},templateUrl:"static/views/platforms/partials/platform-dropdown.html",link:function($scope){$scope.working=!0,$scope.platforms=[{id:-1,name:"Loading..."}],function(){platformsSvc.query().then(function(res){if($scope.platforms=res,$scope.working=!1,""===$scope.selected.name){$scope.selected=$scope.platforms[0];var DEFAULT_PLATFORM="PC (Win)";$scope.platforms.forEach(function(p,idx){p.name===DEFAULT_PLATFORM&&($scope.selected=$scope.platforms[idx])})}})}()}}}])}(Platforms=App.Platforms||(App.Platforms={}))}(App||(App={}));